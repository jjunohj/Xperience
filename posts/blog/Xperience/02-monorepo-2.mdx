---
title: "스타트업 개발자의 모노레포 적용기 (Turborepo + Pnpm) 2편"
description: "모노레포 도구 비교와 선택 과정 (Turborepo vs Nx vs Lerna) 그리고 Pnpm 선택 이유"
category: Xperience
thumbnail: "/images/xperience-02-monorepo-2.png"
tags:
  - Monorepo
  - Turborepo
  - Nx
  - Lerna
  - Pnpm
date: 2024-12-19
---

## 시작하기 전에

> 이런 분들이 읽으시면 좋을 것 같아요.
>
> - 각기 다른 기술과 레거시 코드로 이루어진 여러가지 프로젝트를 동시에 유지보수하고 있는 개발자 혹은 팀
> - 모노레포에 대해 궁금한 개발자
> - 모노레포를 도입하고 싶지만 어떻게 시작해야할지 모르는 개발자

이 글은 시리즈 글이므로, 1편을 먼저 읽어주세요 !

[지난 게시글](/blog/Xperience/01-monorepo-1)에서 아래와 같이 문제 상황과 목표를 정리했습니다.

### 문제 상황

- 노후화되고 통일되지 않은 노드 환경과 라이브러리 버전, 그리고 각기 다른 컨벤션으로 인해 더 이상 프로젝트 유지보수가 어려워졌습니다.
- UI 컴포넌트의 스타일 방식을 통일했으나 각각의 프로젝트에서 별도 레포지토리로 가져와 사용하고 있어 Storybook 레포의 UI 변경 사항을 레포 개수만큼 일일이 옮겨와야 했고, 혹여나 각각의 프로젝트에서 요구 사항이 조금씩 달라 조금씩 UI 컴포넌트를 수정할 경우 이를 모두 추적하기가 쉽지 않았습니다.
- 하나의 프로젝트를 의존성이나 환경을 업그레이드 한다고 해도 다른 프로젝트도 모두 개별적으로 업그레이드를 해줘야 했습니다.

### 목표

- 안정된 LTS 노드 환경을 모든 프로젝트에서 공유하고, 이후 추가적인 업그레이드도 중앙에서 관리할 수 있도록 합니다.
- 여러 프로젝트에서 공통으로 사용하는 라이브러리 버전은 중앙에서 관리할 수 있도록 합니다.
- 공통 UI 컴포넌트의 경우 하나의 레포지토리에서 관리하고, 업데이트 시 추가적인 라이브러리 배포 없이 간단하게 import 하여 사용할 수 있도록 합니다.
- 코드 컨벤션, 린팅 등 기본적인 규칙들을 정하고, 모든 프로젝트에 동일하게 반영합니다.
- 모든 프로젝트에서 동일하게 사용하는 유틸함수, 타입 등을 공통 레포지토리에서 관리하고, 이를 모든 프로젝트에서 공유할 수 있도록 합니다.
- **위 모든 사항에 대한 변경 사항은 모든 레포지토리에 동일하게 반영될 수 있도록 합니다.**

## 모노레포 구성

모노레포를 구성하는 방식에는 크게 두 가지 방법이 있었습니다.

1. 별다른 모노레포 관리 도구없이 패키지 매니저로 모노레포를 구성하는 방법 (Pnpm, Yarn, Npm + workspace)
2. 패키지 매니저와 모노레포 빌드 및 관리 도구를 사용하여 모노레포를 구성하는 방법 (Turborepo, Nx, Lerna 등)

<div style={{ borderRadius: "1rem", textAlign: "center", margin: "1rem" }}>
  <img
    width="600"
    alt="다양한 모노레포 구성 방법"
    src="https://github.com/user-attachments/assets/f3adead4-fccb-4cfd-b975-175b5cc045d5"
  />
  <span style={{ color: "gray", fontSize: "0.8rem" }}>
    다양한 모노레포 구성 방법
  </span>
</div>

### 패키지 매니저 선택

우선적으로 패키지 매니저를 결정해야합니다.

현재 패키지 매니저는 아래와 같이 크게 세 가지 종류가 있습니다. (Yarn같은 경우 크게 두 버전으로 나뉘긴 합니다.)

- Npm
- Yarn (Classic, berry)
- Pnpm

위 세가지 패키지 매니저는 모두 워크스페이스를 기본적으로 지원하지만, 최종적으로 제가 선택한 패키지 매니저는 Pnpm입니다.

물론 이미 개발 조직에서 충분한 논의를 거친 뒤에 조직에 맞는 효율적인 패키지 매니저를 선택했을 수도 있습니다. 그럴 경우, 당시 패키지 매니저를 채택했던 근거를 최대한 보존하는 방향으로 진행하는 것이 좋습니다. 예를 들어 Zero-install과 PnP를 활용하고자 Yarn berry를 도입했다면, 모노레포를 구성할 때도 Yarn berry를 사용하는 것이 훨씬 편리할 것입니다.

[패키지 매니저들의 더욱 상세한 소개는 이 포스팅을 참고해주세요 !]

하지만 Npm 사용은 최대한 지양하려고 했습니다.

그 선택 근거는 다음과 같습니다.

-

따라서 모노레포를 구성을 하기 위해선 우선 패키지 매니저와 모노레포 관리 도구를 결정해야합니다.

모노레포 도입을 하기 위해 여러가지 모노레포 도구들을 조사해보았을 때 크게 세 가지 도구가 존재했습니다.

- Turborepo
- Nx
- Lerna

결론부터 말하자면, 저는 **Turborepo**를 모노레포 도구로 선택했습니다.

지금부터 각각의 도구들에 대해 조금 더 자세히 알아보고, 제가 Turborepo를 선택한 이유에 대해 말씀드리고자 합니다.

모노레포 도구 선택 과정
Turborepo vs Nx vs Lerna 비교
Pnpm을 선택한 이유
실제 마이그레이션 과정
프로젝트 구조 설계
공통 패키지 분리
빌드 파이프라인 구성
도입 후 변화
개발 생산성 향상 사례
새로운 문제점과 해결 방법
팀 협업 방식의 변화

### 출처

[패키지 매니저의 과거, 토스의 선택, 그리고 미래](https://toss.tech/article/lightning-talks-package-manager)
